2. Backup (Replicate) Hyper-V VMs to Azure using Azure Site Recovery (ASR)

This project will let you replicate your Hyper-V VMs (Ubuntu + Windows Server 2019) ‚Äî running inside your Windows 11 host ‚Äî to Azure for disaster recovery.
If your host system or local environment fails, you can failover to Azure and bring those VMs online in the cloud.

üß© Environment Setup
Component	                Description
Host Machine	            Windows 11 OS with Hyper-V enabled
Virtual Machines	        1Ô∏è‚É£ Windows Server 2019 ‚ÄÉ
                            2Ô∏è‚É£ Ubuntu
Azure Services	            Recovery Services Vault, Azure Site Recovery

Network	Internet connectivity between your host and Azure
üîß PART 1 ‚Äî Prepare Azure Side


1Ô∏è‚É£ Create a Recovery Services Vault

Sign in to https://portal.azure.com
Search for Recovery Services vaults ‚Üí Create
Fill in:

Resource Group ‚Äì choose or create one
Vault Name ‚Äì e.g., MaxHybridVault
Region ‚Äì same region you‚Äôll replicate to

Click Review + Create ‚Üí Create

2Ô∏è‚É£ Enable Azure Site Recovery in the Vault

Open your newly created Recovery Services Vault
In the left pane, select Site Recovery
Under Start replicating machines, click Prepare Infrastructure
‚öôÔ∏è PART 2 ‚Äî Prepare Your Hyper-V Host (Windows 11 Machine)

3Ô∏è‚É£ Download the ASR Provider and Registration Key

In the Prepare Infrastructure wizard:
Select ‚ÄúTo Azure‚Äù as the replication goal
Source = Hyper-V Site (without SCVMM)
Target = Azure

Azure will give you:

Microsoft Azure Site Recovery Provider installer (.exe)
Vault Registration Key file (.VaultCredentials)
Download both to your Windows 11 machine.

4Ô∏è‚É£ Install the ASR Provider on your Host

On the Windows 11 machine (your Hyper-V host), run the downloaded installer:
MicrosoftAzureSiteRecoveryProvider.exe

During installation it will ask for:

Vault Registration Key (browse and select the file you downloaded)
This registers your host (Hyper-V site) with Azure.

After registration completes, your Hyper-V host appears in the Azure Portal under:
Site Recovery ‚Üí Hyper-V Hosts

üñ•Ô∏è PART 3 ‚Äî Enable Replication for Each VM
5Ô∏è‚É£ Add the VMs to Replication

In the Azure Portal, open your Recovery Services Vault
Go to Replicated Items ‚Üí + Enable Replication

Choose:

Source ‚Üí The registered Hyper-V Site (your Windows 11 machine)

Host Server ‚Üí It will list your local host

Virtual Machines ‚Üí Select both Ubuntu and Windows Server 2019

6Ô∏è‚É£ Configure Replication Settings

Target Region ‚Äì same as vault region

Storage Account ‚Äì select or create one (for replicated disks)

Network Mapping ‚Äì choose an Azure VNet/subnet for failover VMs

Replication Policy ‚Äì use default (5-min RPO) or customize:

RPO = Recovery Point Objective (e.g., 5 minutes)

App-consistent snapshot = Enable

Retention = 24 hours or more

Click Enable Replication

7Ô∏è‚É£ Monitor Initial Replication

Go to Site Recovery ‚Üí Jobs ‚Üí Replication Jobs

Wait for status Protected ‚Üí Completed

This means both VMs are now continuously replicating to Azure.

üß™ PART 4 ‚Äî Testing Failover (Disaster Recovery Test)
8Ô∏è‚É£ Run a Test Failover

In the vault ‚Üí Replicated Items ‚Üí Select your VM

Click Test Failover

Choose an Azure VNet for the test VM

Azure spins up a temporary copy of your VM in Azure ‚Äî without affecting your on-prem one

After verifying the VM boots and data is intact, click Cleanup Test Failover

‚úÖ Outcome

Both your Ubuntu and Windows Server 2019 VMs on your local Hyper-V host are now replicating to Azure.

You can perform Test Failover, Planned Failover, or Unplanned Failover if your local environment fails.

Data is continuously synchronized for near-real-time recovery.

üß† Quick Concept Recap
Component	Purpose
MARS Agent	File/folder backup (no full VM)
ASR Provider	Registers Hyper-V host with Azure
Vault Registration Key	Authenticates the host to the vault
Recovery Services Vault	Central management of backup and replication
ASR Replication	Full VM replication for disaster recovery